<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="system"></ion-back-button>
    </ion-buttons>
    <ion-title>Sideload Service</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding with-widgets">
  <!-- invalid -->
  <div *ngIf="invalid; else valid" class="drop-area_filled">
    <h4>
      <ion-icon
        name="close-circle-outline"
        color="danger"
        class="inline"
      ></ion-icon>
      Invalid package file
    </h4>
    <ion-button color="primary" (click)="clear()">Try again</ion-button>
  </div>

  <!-- valid -->
  <ng-template #valid>
    <!-- uploaded -->
    <div class="ion-padding" *ngIf="pkgData?.pkg as pkg; else empty">
      <div class="ion-text-right">
        <ion-button color="danger" (click)="clear()">
          <ion-icon slot="icon-only" name="close"></ion-icon>
        </ion-button>
      </div>
      <div class="grid gap-8 mb-16 p-4 lg:px-16 lg:pb-8 pt-14 justify-center">
        <marketplace-package-hero [pkg]="pkg">
          <marketplace-show-controls [pkg]="pkg"></marketplace-show-controls>
        </marketplace-package-hero>
        <marketplace-about [pkg]="pkg"></marketplace-about>
        <div
          *ngIf="!(pkg.manifest.dependencies | empty)"
          class="rounded-xl bg-gradient-to-bl from-zinc-400/75 to-zinc-600 p-px shadow-lg shadow-zinc-400/10 mt-6"
        >
          <div class="lg:col-span-5 xl:col-span-4 bg-zinc-800 rounded-xl p-7">
            <h2 class="text-lg font-bold small-caps my-2 pb-3">Dependencies</h2>
            <div class="grid grid-row-auto gap-3">
              <div *ngFor="let dep of pkg.manifest.dependencies | keyvalue">
                <marketplace-dependencies
                  [dep]="dep"
                  [pkg]="pkg"
                ></marketplace-dependencies>
              </div>
            </div>
          </div>
        </div>
        <marketplace-additional [pkg]="pkg"></marketplace-additional>
      </div>
    </div>
    <!-- empty -->
    <ng-template #empty>
      <div
        class="drop-area"
        [class.drop-area_mobile]="isMobile"
        appDnd
        (onFileDropped)="handleFileDrop($event)"
      >
        <ion-icon
          name="cloud-upload-outline"
          color="dark"
          style="font-size: 42px"
        ></ion-icon>
        <h4>Upload .s9pk package file</h4>
        <p *ngIf="onTor">
          <ion-text color="success">
            Tip: switch to LAN for faster uploads.
          </ion-text>
        </p>
        <ion-button color="primary" type="file" class="ion-margin-top">
          <label for="upload-photo">Browse</label>
          <input
            type="file"
            style="position: absolute; opacity: 0; height: 100%"
            id="upload-photo"
            (change)="handleFileInput($event)"
          />
        </ion-button>
      </div>
    </ng-template>
  </ng-template>
</ion-content>
