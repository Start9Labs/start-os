<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="system"></ion-back-button>
    </ion-buttons>
    <ion-title>Monitor</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding with-widgets">
  <ion-item-group *ngIf="serverData$ | async as serverData; else loading">
    <p *ngIf="websocketFail" class="loading-dots ion-text-center">
      <ion-text color="warning">Websocket Failed. Reconnecting</ion-text>
    </p>

    <ion-item>
      <ion-label>
        <h2>Current Time (UTC)</h2>
        <h2>
          {{ serverData[0].value | date : 'MMMM d, y, h:mm:ss a' : 'UTC' }}
        </h2>
        <p *ngIf="!serverData[0].synced">
          <ion-text color="warning">
            NTP not synced, time could be wrong
          </ion-text>
        </p>
      </ion-label>
    </ion-item>

    <ion-item>
      <ion-label>
        <h1>Uptime</h1>
        <h2 *ngIf="serverData[1] as uptime">
          <b>{{ uptime.days }}</b>
          Days,
          <b>{{ uptime.hours }}</b>
          Hours,
          <b>{{ uptime.minutes }}</b>
          Minutes,
          <b>{{ uptime.seconds }}</b>
          Seconds
        </h2>
      </ion-label>
    </ion-item>

    <ng-container *ngIf="serverData[2] as metrics">
      <ng-container *ngIf="metrics.general as general">
        <ion-item-divider>General</ion-item-divider>
        <ion-item>
          <ion-label>Temperature</ion-label>
          <ion-note slot="end">
            <ng-container *ngIf="general.temperature; else noTemp">
              {{ general.temperature.value }} &deg;C
            </ng-container>
            <ng-template #noTemp>N/A</ng-template>
          </ion-note>
        </ion-item>
      </ng-container>

      <ng-container *ngIf="metrics.memory as memory">
        <ion-item-divider>Memory</ion-item-divider>
        <ion-item>
          <ion-label>Percentage Used</ion-label>
          <ion-note slot="end">
            {{ memory['percentage-used'].value }} %
          </ion-note>
        </ion-item>
        <ion-item>
          <ion-label>Total</ion-label>
          <ion-note slot="end">
            <ion-text>{{ memory.total.value }} MiB</ion-text>
          </ion-note>
        </ion-item>
        <ion-item>
          <ion-label>Used</ion-label>
          <ion-note slot="end">
            <ion-text>{{ memory.used.value }} MiB</ion-text>
          </ion-note>
        </ion-item>
        <ion-item>
          <ion-label>Available</ion-label>
          <ion-note slot="end">{{ memory.available.value }} MiB</ion-note>
        </ion-item>
        <ion-item>
          <ion-label>zram Used</ion-label>
          <ion-note slot="end">{{ memory['zram-used'].value }} MiB</ion-note>
        </ion-item>
        <ion-item>
          <ion-label>zram Total</ion-label>
          <ion-note slot="end">{{ memory['zram-total'].value }} MiB</ion-note>
        </ion-item>
        <ion-item>
          <ion-label>zram Available</ion-label>
          <ion-note slot="end">
            {{ memory['zram-available'].value }} MiB
          </ion-note>
        </ion-item>
      </ng-container>

      <ng-container *ngIf="metrics.cpu as cpu">
        <ion-item-divider>CPU</ion-item-divider>
        <ion-item>
          <ion-label>Percentage Used</ion-label>
          <ion-note slot="end">{{ cpu['percentage-used'].value }} %</ion-note>
        </ion-item>
        <ion-item>
          <ion-label>User Space</ion-label>
          <ion-note slot="end">
            <ion-text>{{ cpu['user-space'].value }} %</ion-text>
          </ion-note>
        </ion-item>
        <ion-item>
          <ion-label>Kernel Space</ion-label>
          <ion-note slot="end">
            <ion-text>{{ cpu['kernel-space'].value }} %</ion-text>
          </ion-note>
        </ion-item>
        <ion-item>
          <ion-label>Idle</ion-label>
          <ion-note slot="end">{{ cpu.idle.value }} %</ion-note>
        </ion-item>
        <ion-item>
          <ion-label>I/O Wait</ion-label>
          <ion-note slot="end">{{ cpu.wait.value }} %</ion-note>
        </ion-item>
      </ng-container>

      <ng-container *ngIf="metrics.disk as disk">
        <ion-item-divider>Disk</ion-item-divider>
        <ion-item>
          <ion-label>Percentage Used</ion-label>
          <ion-note slot="end">{{ disk['percentage-used'].value }} %</ion-note>
        </ion-item>
        <ion-item>
          <ion-label>Capacity</ion-label>
          <ion-note slot="end">
            <ion-text>{{ disk.capacity.value }} GB</ion-text>
          </ion-note>
        </ion-item>
        <ion-item>
          <ion-label>Used</ion-label>
          <ion-note slot="end">
            <ion-text>{{ disk.used.value }} GB</ion-text>
          </ion-note>
        </ion-item>
        <ion-item>
          <ion-label>Available</ion-label>
          <ion-note slot="end">{{ disk.available.value }} GB</ion-note>
        </ion-item>
      </ng-container>
    </ng-container>
  </ion-item-group>

  <ng-template #loading>
    <skeleton-list [groups]="3"></skeleton-list>
  </ng-template>
</ion-content>
