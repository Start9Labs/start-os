<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/backups"></ion-back-button>
    </ion-buttons>
    <ion-title>Backup Targets</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding-top">
  <ion-item-group>
    <ion-item>
      <ion-label>
        <h2>
          Backup targets are physical or virtual locations for storing encrypted
          backups. They can be physical drives plugged into your server, shared
          folders on your Local Area Network (LAN), or third party clouds such
          as Dropbox or Google Drive.
          <a [href]="docsUrl" target="_blank" rel="noreferrer"
            >View instructions</a
          >
        </h2>
      </ion-label>
    </ion-item>

    <ion-item-divider>
      Saved Targets
      <ion-button class="ion-padding-start" strong (click)="presentModalAdd()">
        <ion-icon slot="start" name="add"></ion-icon>
        Add Target
      </ion-button>
      <ion-button class="ion-padding-start" strong (click)="refresh()">
        <ion-icon slot="start" name="refresh"></ion-icon>
        Refresh
      </ion-button>
    </ion-item-divider>

    <div class="grid-fixed">
      <ion-grid class="ion-padding">
        <ion-row class="grid-headings">
          <ion-col size="3">Name</ion-col>
          <ion-col>Type</ion-col>
          <ion-col>Available</ion-col>
          <ion-col size="4">Path</ion-col>
          <ion-col size="2"></ion-col>
        </ion-row>
        <!-- loading -->
        <ng-container *ngIf="loading$ | async; else loaded">
          <ion-row
            *ngFor="let row of ['', '']"
            class="ion-align-items-center row-border"
          >
            <ion-col>
              <p>
                <ion-skeleton-text animated></ion-skeleton-text>
              </p>
            </ion-col>
          </ion-row>
        </ng-container>
        <!-- loaded -->
        <ng-template #loaded>
          <!-- error -->
          <p *ngIf="error$ | async as error; else noError">
            <ion-text color="danger">{{ error }}</ion-text>
          </p>
          <!-- no error -->
          <ng-template #noError>
            <ion-row
              *ngFor="let target of targets.saved; let i = index"
              class="ion-align-items-center grid-row-border"
            >
              <ion-col size="3">{{ target.name }}</ion-col>
              <ion-col class="inline">
                <ion-icon
                  *ngIf="target.type === 'disk'"
                  name="save-outline"
                  size="small"
                ></ion-icon>
                <ion-icon
                  *ngIf="target.type === 'cifs'"
                  name="folder-open-outline"
                  size="small"
                ></ion-icon>
                <ion-icon
                  *ngIf="target.type === 'cloud'"
                  name="cloud-outline"
                  size="small"
                ></ion-icon>
                &nbsp; {{ target.type | titlecase }}
              </ion-col>
              <ion-col>
                <ion-icon
                  [name]="target.mountable ? 'checkmark' : 'close'"
                  [color]="target.mountable ? 'success' : 'danger'"
                ></ion-icon>
              </ion-col>
              <ion-col size="4">{{ target.path }}</ion-col>
              <ion-col size="2">
                <ion-buttons style="float: right">
                  <ion-button size="small" (click)="presentModalUpdate(target)">
                    <ion-icon name="pencil"></ion-icon>
                  </ion-button>
                  <ion-button
                    size="small"
                    (click)="presentAlertDelete(target.id, i)"
                  >
                    <ion-icon name="trash"></ion-icon>
                  </ion-button>
                </ion-buttons>
              </ion-col>
            </ion-row>
          </ng-template>
        </ng-template>
      </ion-grid>
    </div>
  </ion-item-group>
</ion-content>
