<h1 class="heading ion-text-center">{{ name }}</h1>

<ion-grid class="grid">
  <ion-row>
    <ion-col sizeSm="8" offset-sm="2">
      <ion-toolbar color="transparent">
        <ion-searchbar
          enterkeyhint="search"
          color="dark"
          debounce="250"
          [(ngModel)]="query"
        ></ion-searchbar>
      </ion-toolbar>
    </ion-col>
  </ion-row>
</ion-grid>

<ng-container *ngIf="pkgs && categories; else loading">
  <div class="hidden-scrollbar ion-text-center">
    <ion-button
      *ngFor="let cat of categories"
      fill="clear"
      class="category"
      [class.category_selected]="isSelected(cat)"
      (click)="switchCategory(cat)"
    >
      {{ cat }}
    </ion-button>
  </div>

  <div class="divider"></div>

  <ion-grid *ngIf="pkgs | filterPackages: localPkgs:query:category as filtered">
    <div *ngIf="!filtered.length && category === 'updates'" class="ion-padding">
      <h1>All services are up to date!</h1>
    </div>

    <ion-row>
      <ion-col *ngFor="let pkg of filtered" sizeXs="12" sizeSm="12" sizeMd="6">
        <ion-item [routerLink]="['/marketplace', pkg.manifest.id]">
          <ion-thumbnail slot="start">
            <img alt="" [src]="'data:image/png;base64,' + pkg.icon | trust" />
          </ion-thumbnail>
          <ion-label>
            <h2 class="pkg-title">
              {{ pkg.manifest.title }}
            </h2>
            <h3>{{ pkg.manifest.description.short }}</h3>
            <marketplace-status
              class="status"
              [pkg]="localPkgs[pkg.manifest.id]"
            ></marketplace-status>
          </ion-label>
        </ion-item>
      </ion-col>
    </ion-row>
  </ion-grid>
</ng-container>

<ng-template #loading>
  <marketplace-list-skeleton></marketplace-list-skeleton>
</ng-template>
