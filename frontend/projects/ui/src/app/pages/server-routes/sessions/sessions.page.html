<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="system"></ion-back-button>
    </ion-buttons>
    <ion-title>Active Sessions</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding-top with-widgets">
  <ion-item-group>
    <!-- current session -->
    <ion-item-divider>Current Session</ion-item-divider>
    <div class="grid-fixed">
      <ion-grid class="ion-padding" style="min-width: 840px">
        <ion-row class="grid-headings">
          <ion-col size="6">User Agent</ion-col>
          <ion-col size="3">Platform</ion-col>
          <ion-col size="3">Last Active</ion-col>
        </ion-row>
        <!-- loading -->
        <ng-container *ngIf="loading$ | async; else loaded">
          <ion-row class="ion-align-items-center grid-row-border">
            <ion-col>
              <ion-skeleton-text animated></ion-skeleton-text>
            </ion-col>
          </ion-row>
        </ng-container>
        <!-- loaded -->
        <ng-template #loaded>
          <ion-row
            *ngIf="currentSession"
            class="ion-align-items-center grid-row-border"
          >
            <ion-col size="6"> {{ currentSession['user-agent'] }} </ion-col>
            <ion-col size="3" class="inline">
              <span
                *ngIf="currentSession.metadata.platforms | platformInfo as info"
              >
                <ion-icon size="small" [name]="info.icon"></ion-icon>
                &nbsp; {{ info.name }}
              </span>
            </ion-col>
            <ion-col size="3">
              {{ currentSession['last-active']| date: 'medium' }}
            </ion-col>
          </ion-row>
        </ng-template>
      </ion-grid>
    </div>

    <!-- other sessions -->
    <ion-item-divider>
      Other Sessions
      <ion-button
        class="ion-padding-start"
        strong
        color="primary"
        [fill]="!selected.size ? 'outline' : 'solid'"
        (click)="kill()"
        [disabled]="!selected.size"
      >
        Terminate Selected
      </ion-button>
    </ion-item-divider>

    <div class="grid-fixed">
      <ion-grid class="ion-padding">
        <ion-row class="grid-headings">
          <ion-col size="6" class="inline">
            <ion-checkbox
              style="margin-right: 12px"
              [checked]="selected.size"
              (ionChange)="toggleAll($any($event))"
            ></ion-checkbox>
            User Agent
          </ion-col>
          <ion-col size="3">Platform</ion-col>
          <ion-col size="3">Last Active</ion-col>
        </ion-row>
        <!-- loading -->
        <ng-container *ngIf="loading$ | async; else loaded2">
          <ion-row
            *ngFor="let row of ['', '']"
            class="ion-align-items-center grid-row-border"
          >
            <ion-col>
              <ion-skeleton-text animated></ion-skeleton-text>
            </ion-col>
          </ion-row>
        </ng-container>
        <!-- loaded -->
        <ng-template #loaded2>
          <ion-row
            *ngFor="let session of otherSessions; let i = index"
            class="ion-align-items-center grid-row-border"
          >
            <ion-col size="6" class="inline">
              <ion-checkbox
                style="margin-right: 12px"
                [checked]="selected.has(session.id)"
                (ionChange)="toggleChecked(session.id, $any($event))"
              ></ion-checkbox>
              {{ session['user-agent'] }}
            </ion-col>
            <ion-col size="3" class="inline">
              <span *ngIf="session.metadata.platforms | platformInfo as info">
                <ion-icon size="small" [name]="info.icon"></ion-icon>
                &nbsp; {{ info.name }}
              </span>
            </ion-col>
            <ion-col size="3">
              {{ session['last-active']| date: 'medium' }}
            </ion-col>
          </ion-row>
          <p *ngIf="!otherSessions.length">
            You are not logged in anywhere else
          </p>
        </ng-template>
      </ion-grid>
    </div>
  </ion-item-group>
</ion-content>
